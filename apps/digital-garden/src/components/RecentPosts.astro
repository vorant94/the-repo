---
import { getCollection } from "astro:content";
import { getRelativeLocaleUrl } from "astro:i18n";
import {
  createFilterPostsByLang,
  sortPostsByPublishedAt,
} from "../utils/content.helpers";
import { createTranslate } from "../utils/i18n.helpers";
import PostTiledList from "./PostTiledList.astro";
import PostTiledListEmptyItem from "./PostTiledListEmptyItem.astro";
import PostTiledListItem from "./PostTiledListItem.astro";

const filteredPosts = await getCollection(
  "posts",
  createFilterPostsByLang(Astro.currentLocale),
);
const sortedPosts = sortPostsByPublishedAt(filteredPosts);
const recentPosts = sortedPosts.slice(0, 3);

const t = createTranslate(Astro.currentLocale);
---

<PostTiledList title={t("recent-posts.title")}>
	{recentPosts.map((post) => (
		<PostTiledListItem post={post} />
	))}

	<PostTiledListEmptyItem href={getRelativeLocaleUrl(Astro.currentLocale!, "/posts")}>
    {t("recent-posts.see-all")}
	</PostTiledListEmptyItem>
</PostTiledList>
