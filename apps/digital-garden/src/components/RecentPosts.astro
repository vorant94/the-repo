---
import { getCollection } from "astro:content";
import { getRelativeLocaleUrl } from "astro:i18n";
import { sortPostsByPublishedAt } from "../utils/content.helpers";
import PostTiledList from "./PostTiledList.astro";
import PostTiledListEmptyItem from "./PostTiledListEmptyItem.astro";
import PostTiledListItem from "./PostTiledListItem.astro";

const filteredPosts = await getCollection("posts", (post) => {
  const [postLang] = post.id.split("/");
  return Astro.currentLocale === postLang && !post.data.isPinned;
});
const sortedPosts = sortPostsByPublishedAt(filteredPosts);
const recentPosts = sortedPosts.slice(0, 3);
---

<PostTiledList title={"Recent Posts"}>
	{recentPosts.map((post) => (
		<PostTiledListItem post={post} />
	))}

	<PostTiledListEmptyItem href={getRelativeLocaleUrl(Astro.currentLocale!, "/posts")}>
		See all
	</PostTiledListEmptyItem>
</PostTiledList>
